---
title: "dm-project"
author: "Daphné Perry and Justine Catta"
format: html
---

# Introduction


# Presenting our data

### Our data
1. 
Environmental tax revenues (in million of USD): energy, transport, pollution, resources
source : OECD
time period : 1994-2023

2. 
GDP and Added Value per capita annual growth per sector (in million of USD)
source : OECD
time period : 1990-2024

3.
Greenhouse gas emissions by source sector (in million of ton)
source : Eurostat
time period : 1990-2024

4.
Inability to keep home adequately warm
source : Eurostat
time period : 2003-2024

#### Justification for the Sector Mapping Between ISIC and CRF Classifications

The reconciliation of sectors across the ISIC-based dataset and the CRF (Common Reporting Format) classification relies on aligning economic activities with their dominant emission sources. Although the two systems are not structurally identical—ISIC being an economic activity classification and CRF being an emissions reporting framework—several robust correspondences can be established.

First, Agriculture, forestry and fishing (ISIC A) is mapped to CRF 3 (Agriculture). Both refer to primary-sector biological production and include emissions directly linked to agricultural practices such as enteric fermentation, manure management, and agricultural soils.

Second, Manufacturing (ISIC C) is associated with CRF 1.A.2 (Manufacturing industries and construction) and CRF 2 (Industrial processes and product use). Manufacturing activity generates emissions both from fuel combustion in industrial facilities (covered by 1.A.2) and from process-related sources such as cement, chemicals, or metals production (covered by CRF 2), making this linkage consistent with the structure of industrial emissions.

Third, Electricity, gas, steam and air conditioning supply (ISIC D)—even though aggregated within “Industry (except construction)” in the first dataset—logically corresponds to CRF 1.A.1 (Public electricity and heat production). This CRF category captures emissions from power generation and heat production, which are the core activities of ISIC D.

Finally, Transportation and storage (ISIC H)—included in a broader aggregated category in the dataset—is aligned with CRF 1.A.3 (Transport). This CRF category encompasses fuel combustion from road, rail, aviation, and navigation transport, which directly reflects the operational scope of ISIC H.

Overall, the mapping follows a principle of dominant emission source equivalence, ensuring that each ISIC activity is linked to the CRF category representing the primary origin of its greenhouse gas emissions. This approach allows the two datasets—despite structural differences—to be compared and integrated in a coherent and meaningful way for our analysis.


### Setup
```{r}
library(vroom)
library(ggplot2)
library(knitr)
library(dplyr)
library(here)
```

```{r}
here::i_am("project.Rproj")
```


### Data loading
```{r}
Envt_Tax_Revenues <- vroom(here("data", "OECD_envt_tax.csv"))
GDP_and_AV <- vroom(here("data", "OECD_GDP_and_AV.csv"))
GHG_Emissions <- vroom(here("data", "Eurostat_ghg.csv"))
Warm_Households <- vroom(here("data","Eurostat_warm.csv"))
```
### Modifying the datasets

#### Removing unwanted variables
```{r}
Warm_Households <- Warm_Households |>
  select(geo, TIME_PERIOD, hhtyp, incgrp, OBS_VALUE)
Envt_Tax_Revenues <- Envt_Tax_Revenues |>
  select(REF_AREA, `Fréquence d'observation...8`, 
         TIME_PERIOD, OBS_VALUE, CATEGORY, 
         `Catégorie de recettes provenant des taxes liées à l'environnement`)
GDP <- GDP_and_AV |>
  select(REF_AREA, `Zone de référence`, 
         Transaction, TIME_PERIOD, OBS_VALUE)|>
  filter(Transaction == "Produit intérieur brut")
Added_value <- GDP_and_AV |>
  select(REF_AREA, `Zone de référence`, `Activité économique`, 
         Transaction, TIME_PERIOD, OBS_VALUE)|>
  filter(Transaction == "Valeur ajoutée, brute")
GHG_Emissions <- GHG_Emissions |>
  select(airpol, src_crf, geo, TIME_PERIOD, OBS_VALUE)
```

#### Deleting some entities
```{r}
Added_value <- Added_value |>
  filter(`Activité économique` %in% c(
    "Agriculture, sylviculture et pêche",
    "Activités de fabrication",
    "Industrie (sauf construction)",
    "Commerce de gros et de détail; réparation de véhicules automobiles et de motocyclettes; transport et stockage; activités d'hébergement et de restauration"
  ))
# virer les gaz & les secteurs osefs de GHG ? 

```

```{r}
Warm_Households <- Warm_Households |>
  filter(hhtyp %in% c("A1F", "A1M", "TOTAL"))
```


#### Adding some entities

##### Add European average (accross countries)
```{r}
EU27_GDP <- GDP |>
  filter(Transaction == "Produit intérieur brut") |>
  group_by(TIME_PERIOD, Transaction) |>
  summarise(across(where(is.numeric), \(x) mean(x, na.rm = TRUE))) |>
  mutate(`Zone de référence` = "Moyenne européenne") |>
  relocate(`Zone de référence`)
GDP <- bind_rows(GDP, EU27_GDP)
  # add eu average ds ts datasets
  # add country average ds GDP & GHG

```

```{r}
EU27_Tax <- Envt_Tax_Revenues |>
   group_by(TIME_PERIOD, CATEGORY,
            `Catégorie de recettes provenant des taxes liées à l'environnement`) |>
  summarise(across(where(is.numeric), \(x) mean(x, na.rm = TRUE))) |>
  mutate(`Fréquence d'observation...8` = "Moyenne européenne") |>
  relocate(`Fréquence d'observation...8`)
Envt_Tax_Revenues <- bind_rows(Envt_Tax_Revenues, EU27_Tax)
```

```{r}
EU27_Warming <- Warm_Households |>
   group_by(TIME_PERIOD, hhtyp, incgrp) |>
  summarise(across(where(is.numeric), \(x) mean(x, na.rm = TRUE))) |>
  mutate(geo = "Moyenne européenne") |>
  relocate(geo)
Warm_Households <- bind_rows(Warm_Households, EU27_Warming)
```

##### Add country average (accross sectors)
EU27_VA <- GDP_and_AV |>
  filter(transaction == "Valeur ajoutée") |>
  group_by(TIME_PERIOD, transaction, secteur) |>
  summarise(across(where(is.numeric), \(x) mean(x, na.rm = TRUE))) |>
  mutate(`Zone de référence` = "Moyenne européenne",
         Pays = "EU27") |>
  relocate(Pays)
GDP_and_AV <- bind_rows(GDP_and_AV,EU27_VA)

#### Renaming some variables
```{r}

```


# Descriptive analyzes

# 


